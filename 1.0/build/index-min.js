/*! align-plugin - v1.0 - 2013-06-13 5:23:35 PM
* Copyright (c) 2013 huya; Licensed  */
KISSY.add("gallery/align-plugin/1.0/index",function(a){"use strict";function b(a){this._handles={},a.host&&(this._host=a.host,a.align&&this.to(a))}var c=a.DOM;return a.mix(b.prototype,{to:function(c){if(c=c||this._syncArgs,this._syncArgs=c,!c)return this;var d=c.node,e=c.points[0],f=c.points[1],g=c.resize,h=c.offset||[0,0],i=c.fixed,j=!!(d==window||d&&d[0]==window),k=6==a.UA.ie;if((j||d&&a.isUndefined(d.top))&&(d=this.region(d)),d){var l=[d.left,d.top],m=[d.width,d.height],n=b.points,o=this._host,p=null,q=[o.outerWidth(),o.outerHeight()],r=[0-q[0],0-q[1]],s=e?n[e.charAt(0)]:p,t=e&&"cc"!==e?n[e.charAt(1)]:p,u=f?n[f.charAt(0)]:p,v=f&&"cc"!==f?n[f.charAt(1)]:p;if(s&&(l=s(l,m,e)),t&&(l=t(l,m,e)),u&&(l=u(l,r,f)),v&&(l=v(l,r,f)),l&&o)if(l=[l[0]+h[0],l[1]+h[1]],i){var w=b.fixedPoints[i.charAt(1)],x=b.fixedPoints[i.charAt(0)],y={};k?g=c.resize=!0:y.position="fixed",l=b.fixedPoints(l,q,i,j,k),y[w]=l[0],y[x]=l[1],this.reset(),o.css(y)}else this.reset(),o.offset({left:l[0],top:l[1]});this._toggleHandle(g,"resize"),k&&this._toggleHandle(!!i,"scroll")}return this},sync:function(){return this.to.call(this,this._syncArgs),this},center:function(a){return a=a||this._syncArgs,a&&(a.points=["cc","cc"],this.to(a)),this},region:function(b){var d,e,f,g,h;return(b=a.one(b))?(b[0]==window?(e=c.scrollTop(window),f=c.scrollLeft(window),g=c.viewportWidth(),h=c.viewportHeight()):(d=b.offset(),e=d.top,f=d.left,g=b.outerWidth(),h=b.outerHeight()),{top:e,left:f,bottom:e+h,right:f+g,width:g,height:h}):null},reset:function(){return this._host.css({top:"auto",left:"auto",bottom:"auto",right:"auto"}),this},destroy:function(){this._toggleHandle(!1,"resize"),this._toggleHandle(!1,"scroll")},_toggleHandle:function(b,c){var d=this._handles[c];b&&!d?(a.Event.on(window,c,this._onsync,this),this._handles[c]=this._onsync):!b&&d&&(a.Event.detach(window,c,this._onsync,this),delete this._handles[c],d=null)},_onsync:function(){var a=this;setTimeout(function(){a.sync()},0)}}),b.points={t:function(a){return a},r:function(a,b){return[a[0]+b[0],a[1]]},b:function(a,b){return[a[0],a[1]+b[1]]},l:function(a){return a},c:function(a,b,c){var d,e,f="t"===c[0]||"b"===c[0]?0:1;return"cc"===c?d=[a[0]+b[0]/2,a[1]+b[1]/2]:(e=a[f]+b[f]/2,d=f?[a[0],e]:[e,a[1]]),d}},b.fixedPoints=function(a,c,d,e,f){var g=b.prototype.region(window),h=b.fixedPoints[d.charAt(1)],i=b.fixedPoints[d.charAt(0)],j="right"==h?c[0]:0,k="bottom"==i?c[1]:0,l=e&&!f?0:g.left,m=e&&!f?0:g.top,n="right"==h?-1:1,o="bottom"==i?-1:1;return[(a[0]+j-g[h]+l)*n,(a[1]+k-g[i]+m)*o]},a.mix(b.fixedPoints,{t:"top",b:"bottom",l:"left",r:"right"}),b.NAME="Align",b.NS="align",a.namespace("NodePlugin"),a.NodePlugin.Align=b,b},{requires:["node","event","gallery/pluginhost/1.0/"]});